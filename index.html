<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modern Contact & Booking Form</title>
  <!-- Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Load Boxicons for the icons -->
  <link rel='stylesheet' href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css'>
  <!-- Load Poppins font (from login form) -->
  <link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap'>
  
  <style>
    /* Custom styles to ensure Poppins is used and the body is centered */
    * {
        font-family: 'Poppins', sans-serif;
    }
    
    /* Ensure body fills the viewport and uses a soft background */
    body {
        min-height: 100vh;
        background-color: #f3f4f6; /* Light gray background */
    }

    /* Input box for relative positioning of the icon and label */
    .input_box {
        position: relative;
        /* Increased height slightly to accommodate the padding on date/time inputs */
        min-height: 3.5rem; 
    }

    /* Style the input field itself, adapting the login form style */
    .input-field {
        padding: 0.75rem 1rem 0.75rem 2.5rem; /* Padding for the icon */
        transition: border-color 0.3s, box-shadow 0.3s;
        /* Custom focus ring from the contact form (but using Tailwind classes for visual cues) */
        border-color: #e5e7eb;
    }
    .input-field:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(0, 59, 91, 0.3); 
        border-color: #003b5b;
    }

    /* Icon position inside the input box (from login form) */
    .icon {
        position: absolute;
        top: 50%;
        left: 0.75rem;
        transform: translateY(-50%);
        color: #9ca3af; /* Gray-400 */
        font-size: 1.5rem;
        pointer-events: none; /* Icon should not interfere with input interaction */
    }
    
    /* Style for textarea (no inline icon) */
    .textarea-field {
        padding: 0.75rem 1rem;
        transition: border-color 0.3s, box-shadow 0.3s;
    }
    .textarea-field:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(0, 59, 91, 0.3); 
        border-color: #003b5b;
    }
  </style>
</head>
<body class="flex items-center justify-center p-4">

    <div class="wrapper w-full max-w-lg">
        <!-- Message Box (Hidden by default - from index.html) -->
        <div id="message-box" class="hidden fixed top-4 right-4 z-50 p-4 rounded-lg text-white font-semibold shadow-xl transition-opacity duration-300 opacity-0" role="alert">
            <!-- Content will be inserted by JavaScript -->
        </div>

        <!-- Form Card (from login_form.html) -->
        <div class="login_box bg-white p-6 md:p-10 rounded-xl shadow-2xl space-y-6">
            
            <!-- Header -->
            <div class="login-header text-center">
                <h4 class="text-3xl font-extrabold text-[#003b5b] mb-2">Book an Appointment</h4>
                <p class="text-gray-500 text-base">Fill out the details below and we'll get back to you!</p>
            </div>

            <form method="post" action="" name="contact-form" class="space-y-4 mt-6">
            
                <!-- Input: Name -->
                <div class="input_box">
                    <input type="text" name="your-name" placeholder="Full Name" required
                           class="input-field w-full border border-gray-300 rounded-lg text-gray-800"
                    >
                    <i class="bx bx-user icon"></i>
                </div>
                
                <!-- Input: Number -->
                <div class="input_box">
                    <input type="tel" name="your-number" placeholder="Phone Number" required
                           class="input-field w-full border border-gray-300 rounded-lg text-gray-800"
                    >
                    <i class="bx bx-phone icon"></i>
                </div>

                <!-- Input: Email -->
                <div class="input_box">
                    <input type="email" name="your-email" placeholder="Email Address" required
                           class="input-field w-full border border-gray-300 rounded-lg text-gray-800"
                    >
                    <i class="bx bx-envelope icon"></i>
                </div>

                <!-- Date and Time Inputs in a responsive grid -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Input: Date -->
                    <div class="input_box">
                        <input type="date" name="your-date" required
                               class="input-field w-full border border-gray-300 rounded-lg text-gray-800 pr-3" 
                        >
                        <i class="bx bx-calendar icon"></i>
                    </div>
                    <!-- Input: Time -->
                    <div class="input_box">
                        <input type="time" name="your-time" required
                               class="input-field w-full border border-gray-300 rounded-lg text-gray-800 pr-3"
                        >
                        <i class="bx bx-time-five icon"></i>
                    </div>
                </div>

                <!-- Textarea: Message -->
                <div>
                    <textarea name="message" rows="4" placeholder="Briefly describe your request..." required
                              class="textarea-field w-full border border-gray-300 rounded-lg text-gray-800 resize-none"
                    ></textarea>
                </div>

                <!-- Submit Button -->
                <div class="input_box pt-2 h-auto">
                    <button type="submit" id="submit"
                           class="input-submit w-full py-3 bg-orange-500 text-white font-semibold rounded-lg 
                                  hover:bg-orange-600 transition duration-300 shadow-lg cursor-pointer 
                                  focus:outline-none focus:ring-4 focus:ring-orange-300 active:scale-[0.98]">
                        Confirm Booking
                    </button>
                </div>
            </form>
        </div>
    </div>

<script>
    // --- Google Sheets Submission Logic (from index.html) ---
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyLk3LNqAIGdR5yy_ylJbT_u1q7x1OuJ0IQqJXk47NF-koVS2aBt8QXGyQ6cM9Q9QaiAw/exec';
    const form = document.forms['contact-form'];
    const messageBox = document.getElementById('message-box');

    /**
     * Shows a custom, transient message box instead of using alert().
     * @param {string} message - The text to display.
     * @param {string} type - 'success' or 'error'.
     */
    function showMessage(message, type = 'success') {
        messageBox.textContent = message;
        
        // Reset classes
        messageBox.classList.remove('hidden', 'bg-red-500', 'bg-green-600', 'opacity-0');

        if (type === 'success') {
            messageBox.classList.add('bg-green-600');
        } else {
            messageBox.classList.add('bg-red-500');
        }

        // Show with animation
        messageBox.classList.add('opacity-100');

        // Hide after 5 seconds
        setTimeout(() => {
            messageBox.classList.remove('opacity-100');
            messageBox.classList.add('opacity-0');
            
            // Wait for transition to complete before hiding fully
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 300); 
        }, 5000);
    }
    
    // Simple Exponential Backoff Retry mechanism
    async function submitFormWithRetry(url, formData, maxRetries = 3, delay = 1000) {
        for (let i = 0; i < maxRetries; i++) {
            try {
                const response = await fetch(url, { method: 'POST', body: formData });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response; // Success, return the response
            } catch (error) {
                console.error(`Attempt ${i + 1} failed:`, error);
                if (i === maxRetries - 1) {
                    throw error; // Throw final error if all retries fail
                }
                await new Promise(resolve => setTimeout(resolve, delay * (2 ** i)));
            }
        }
    }


    form.addEventListener('submit', async e => {
        e.preventDefault();
        
        const submitButton = document.getElementById('submit');
        const originalText = submitButton.textContent;
        
        // Disable button and show loading state
        submitButton.disabled = true;
        submitButton.textContent = 'Submitting...';

        try {
            await submitFormWithRetry(scriptURL, new FormData(form));
            
            // Success response
            showMessage("Booking confirmed! Your details have been submitted successfully.", 'success');
            form.reset();
            
        } catch (error) {
            // Error response
            console.error('Final Submission Error:', error);
            showMessage("Submission failed. Please check your connection and try again.", 'error');
            
        } finally {
            // Re-enable button and restore text
            submitButton.disabled = false;
            submitButton.textContent = originalText;
        }
    });
</script>

</body>
</html>
